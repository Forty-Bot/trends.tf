{# SPDX-License-Identifier: AGPL-3.0-only #}
{# Copyright (C) 2020 Sean Anderson <seanga2@gmail.com> #}
{% from "macros/filter.html" import filter %}
{% from "macros/format.html" import optformat, optint %}
{% from "macros/logs.html" import log_table %}
{% from "macros/pretty.html" import class_map, format_map, league_map %}
{% from "macros/wlt.html" import wlt %}
{% extends "player/base.html" %}
{% block title %}Overview - {{ super() }}{% endblock %}
{% block content %}
	{{ super() }}

	<h2>Overview</h2>
	{{ filter() }}
	<div class="box">
	<div class="float">
	<h3>Classes</h3>
	<table>
		<thead>
			<tr>
				<th><abbr title="Games with at least &frac23; time on this class">
					Class
				</abbr></th>
				<th><abbr title="Wins-Losses-Ties, without ties under 60s">
					W-L-T
				</abbr></th>
				<th><abbr title="Winrate, ties count as 0.5 wins">Winrate</abbr></th>
				<th><abbr title="Average Damage per Minute">DA/M</abbr></th>
				<th><abbr title="Average Accuracy">Acc</abbr></th>
				<th><abbr title="Average damage per shot">DA/S</abbr></th>
				<th>Time Played</th>
			</tr>
		</thead>
		<tbody>
			{% for cls in classes %}
			<tr>
				<td class="left">{{ class_map[cls['class']] }}</td>
				<td>{{ wlt(cls['wins'], cls['losses'], cls['ties']) }}</td>
				<td>{{ optformat("{:.2%}", cls['winrate']) }}</td>
				<td>{{ optint(cls['dpm']) }}</td>
				<td>{{ optformat("{:.0%}", cls['acc']) }}</td>
				<td>{{ optint(cls['dps']) }}</td>
				<td>{{ cls['time'] | duration }}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	</div>

	<div class="float">
	<h3>Formats</h3>
	<table>
		<thead>
			<tr>
				<th>Format</th>
				<th><abbr title="Wins-Losses-Ties, without ties under 60s">
					W-L-T
				</abbr></th>
				<th><abbr title="Winrate, ties count as 0.5 wins">Winrate</abbr></th>
				<th>Time Played</th>
			</tr>
		</thead>
		<tbody>
			{% for fmt in formats %}
			<tr>
				<td class="left">{{ format_map[fmt['format']] }}</td>
				<td>{{ wlt(fmt['wins'], fmt['losses'], fmt['ties']) }}</td>
				<td>{{ optformat("{:.2%}", fmt['winrate']) }}</td>
				<td>{{ fmt['time'] | duration }}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	</div>

	<div class="float">
	<h3>Aliases</h3>
	<table>
		<thead>
			<tr>
				<th>Name</th>
				<th>Count</th>
			</tr>
		</thead>
		<tbody>
			{% for alias in aliases %}
			<tr>
				<td class="left">{{ alias['name'] }}</td>
				<td>{{ alias['count'] }}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	{% if request.args.values() | any %}
		<p>Filtering aliases is not supported.</p>
	{% endif %}
	</div>
	{% if teams | length %}
	<div class="float">
	<h3>Recent Teams</h3>
	<table>
		<thead>
			<tr>
				<th>League</th>
				<th>Team</th>
				<th>Most-recent Competition</th>
				<th><abbr title="Division of most-recent competition">
					Division
				</abbr></th>
				<th><abbr title="Format of most-recent competition">
					Format
				</abbr></th>
				<th><abbr title="Most-recent join date">Rostered From</abbr></th>
				<th><abbr title="Most-recent leave date">Rostered To</abbr></th>
			</tr>
		</thead>
		<tbody>
			{% for team in teams %}
			<tr>
				<td class="left">{{ league_map[team['league']] }}</td>
				<td class="left">{{ team['team'] }}</td>
				<td class="left">{{ team['comp'] }}</td>
				<td class="left">{{ team['div'] if team['div'] != None }}</td>
				<td class="left">{{ format_map[team['format']] }}</td>
				{% if team['from'] != None %}
					<td class="left date" timestamp="{{ team['from'] }}"></td>
				{% else %}
					<td></td>
				{% endif %}
				{% if team['to'] != None %}
					<td class="left date" timestamp="{{ team['to'] }}"></td>
				{% else %}
					<td></td>
				{% endif %}
			</tr>
			{% endfor %}
		</tbody>
	</table>
	</div>
	{% endif %}
	</div>

	<p>
		If you are looking for per-class averages, they have moved to the
		<a href="{{ url_for(".totals", steamid=g.player['steamid64']) }}">totals page</a>.
	</p>

	<h2><a href="{{ url_for('.logs', steamid=g.player['steamid64']) }}">Recent Logs</a></h2>
	{{ log_table(logs) }}
{% endblock %}
