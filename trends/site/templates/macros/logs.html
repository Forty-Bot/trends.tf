{# SPDX-License-Identifier: AGPL-3.0-only #}
{# Copyright (C) 2020 Sean Anderson <seanga2@gmail.com> #}
{% from "macros/class.html" import classicon %}
{% from "macros/format.html" import optformat, optint %}
{% from "macros/wlt.html" import wlt %}
{% macro _log_header(extra) %}
<tr>
	{% if extra %}
	<th></th>
	{% endif %}
	<th>Title</th>
	<th>Map</th>
	<th><abbr title="Classes, ordered by playtime">Classes</abbr></th>
	<th><abbr title="Rounds Won-Lost-Tied, without ties under 60s">
		W-L-T
	</abbr></th>
	<th>Format</th>
	<th>Duration</th>
	<th><abbr title="Kills">K</abbr></th>
	<th><abbr title="Deaths">D</abbr></th>
	<th><abbr title="Assists">A</abbr></th>
	<th><abbr title="Damage per Minute">D/M</abbr></th>
	<th><abbr title="Damage Taken per Minute">DT/M</abbr></th>
	<th><abbr title="Healing Given per Minute ">HG/M</abbr></th>
	<th><abbr title="Healing Recieved per Minute ">HR/M</abbr></th>
	<th><abbr title="Accuracy">Acc</abbr></th>
	<th>Date</th>
	{% if extra %}
	<th>Demo</th>
	<th><abbr title="Some logs are duplicates of other logs">Duplicate of</abbr></th>
	{% endif %}
</tr>
{% endmacro %}
{% macro log_table(logs, extra=False) %}
<table>
	<thead>{{ _log_header(extra) }}</thead>
	<tbody>
		{% for log in logs %}
		<tr>
			{% if extra %}
			<td class="left">
				<input form="combine" type="checkbox" name="id"
				 value="{{ log['logid'] }}">
			</td>
			{% endif %}
			<td class="left">
				<a href="{{ url_for('root.log', logids=log['logid'],
				                    _anchor=g.player['steamid64']) }}">
					{{ log['title'] }}
				</a>
			</td>
			<td class="left">{{ log['map'] }}</td>
			<td class="left">
			{% if log['classes'] %}
			{% for (cls, pct) in zip(log['classes'], log['class_pct']) %}
				{{ classicon(cls, pct) }}
			{% endfor %}
			{% endif %}
			</td>
			{% if log['wins'] > log['losses'] %}
				<td class="win">
			{% elif log['wins'] < log['losses'] %}
				<td class="loss">
			{% else %}
				<td class="tie">
			{% endif %}
				{{ wlt(log['wins'], log['losses'], log['ties']) }}
			</td>
			<td class="left">{{ log['format'] }}</td>
			<td>{{ log['duration'] | duration }}</td>
			<td>{{ log['kills'] }}</td>
			<td>{{ log['deaths'] }}</td>
			<td>{{ log['assists'] }}</td>
			<td>{{ log['dpm'] | int }}</td>
			<td>{{ optint(log['dtm']) }}</td>
			<td>{{ log['hpm_given'] | int }}</td>
			<td>{{ log['hpm_recieved'] | int }}</td>
			<td>{{ optformat("{:.0%}", log['acc']) }}</td>
			<td class="left date" timestamp="{{ log['time'] }}"></td>
			{% if extra %}
			<td>
				{% if log['demoid'] %}
				<a href="https://demos.tf/{{ log['demoid'] }}">
					{{ log['demoid'] }}
				</a>
				{% endif %}
			</td>
			<td>
				{% if log['duplicate_of'] %}
				<a href="{{ url_for('root.log', logids=log['duplicate_of']) }}">
					{{ log['duplicate_of'] }}
				</a>
				{% endif %}
			</td>
			{% endif %}
		</tr>
		{% endfor %}
	</tbody>
	{% if extra %}
		<tfoot>{{ _log_header(extra) }}</tfoot>
	{% endif %}
</table>
{% endmacro %}
