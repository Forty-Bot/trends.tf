{# SPDX-License-Identifier: AGPL-3.0-only #}
{# Copyright (C) 2020 Sean Anderson <seanga2@gmail.com> #}
{% from "macros/form.html" import hidden_excluding %}
{% from "macros/pretty.html" import class_map, format_map %}
{% macro _create_options(default, options) %}
{% for key, content in options.items() %}
	<option {{ "selected" if key == default }} value="{{ key }}">{{ content }}</option>
{% endfor %}
{% endmacro %}
{% macro filter(date=True, logs=False) %}
<form>
	{{ hidden_excluding('class', 'format', 'map', 'timezone', 'title', 'steamid64',
			    'date_from', 'date_to') }}
	{% if logs %}
	<label>Title:
		<input type="text" name="title"
		       value="{{ (g.filters['title'] or "") | trim("%") }}">
	</label>
	{% else %}
	<label>
		<abbr title="Games with at least &frac23; time on this class">Class</abbr>:
		<select name="class">
			<option></option>
			{{ _create_options(g.filters['class'], class_map) }}
		</select>
	</label>
	{% endif %}
	<label>Format:
		<select name="format">
			<option></option>
			{{ _create_options(g.filters['format'], format_map) }}
		</select>
	</label>
	<label>Map:
		<input id="map_input" type="text" name="map" list="maps"
		 value="{{ (g.filters['map'] or "") | trim("%") }}">
		<datalist id="maps"></datalist>
	</label>
	<label>Players:
		<select id="players_input" name="steamid64" multiple>
			{% for player in g.filters['players'] %}
			<option selected value="{{ player['steamid64'] }}"
			 data-avatarhash="{{ player['avatarhash'] }}">
				{{ player['name'] }}
			</option>
			{% endfor %}
		</select>
	</label>
	{% if date %}
	<input id="timezone" type="hidden" name="timezone">
	<label>From:
		<input type="date" name="date_from" value="{{ g.filters['date_from'] or "" }}">
	</label>
	<label>To:
		<input type="date" name="date_to" value="{{ g.filters['date_to'] or "" }}">
	</label>
	{% endif %}
	<button type="submit">Filter</button>
</form>
{% endmacro %}
